---
- name: Create swapfile
  command:
    cmd: dd if=/dev/zero of=/swapfile bs=1G count=16 status=progress
    creates: /swapfile
  register: swap_file_created

- name: Set permissions on swapfile
  file:
    path: /swapfile
    owner: root
    group: root
    mode: 0600
  when: swap_file_created is changed

- name: Mark file as swap
  command: mkswap /swapfile
  when: swap_file_created is changed

- name: Enable swap on file
  command: swapon /swapfile
  when: swap_file_created is changed

- name: Add swap to fstab mount table
  mount:
    name: none
    src: /swapfile
    fstype: swap
    opts: sw
    state: present

- name: Set swappiness
  sysctl:
    name: vm.swappiness
    value: 6
    state: present

- name: Set cache pressure
  sysctl:
    name: vm.vfs_cache_pressure
    value: 10
    state: present
